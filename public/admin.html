<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

	<link href="stylesheets/style.css" rel="stylesheet"> 
	<script src="javascripts/jquery-3.1.1.js"></script>
    <link href="stylesheets/bootstrap.min.css" rel="stylesheet"> <!-- Bootstrap -->
	<script src="javascripts/bootstrap.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  
  <body>
  
    <h1>Projet Industriel TenderLift</h1>
	
	<div class="container">
	  <div class="row">
		<div class="col-md-6 col-xs-6"> Nom bateau </div>
		<div class="col-md-6 col-xs-6"> 
			<!---- <button type="button" class="btn btn-primary" id="viderListe"> 
				Vider Liste
			</button>		-->
		</div>

		</div>				
	  
	  
	  <div class="row">
		<div class="col-md-12 col-xs-12">Controles Utilisateur </br>
                <table id="myTable" class="col-md-6 col-xs-6">
				</table>
		</div>
		</br>
	  </div>
	  
	   <div class="row">
		<div class="col-md-6 col-xs-6">Information-Contact </div>
		<div class="col-md-6 col-xs-6"> Tenderlift - +33 (0)4 68 73 59 12 - Canet - 66</div>
	  </div>
	</div>
	
	<div class="modal fade" tabindex="-1" role="dialog" id="modalAccept">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								<h4 class="modal-title">Accepter Invité </h4>
							</div>
							<div class="modal-body">			<!-- modal Body -->
								<label for="usr">Accepter l'invité ? </label>
							</div>		<!-- modal Body -->
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal" id="declineButton">Non</button>
								<button type="button" class="btn btn-primary" id="acceptButton">Oui</button>
							</div>
						</div>		<!-- /.modal-content -->
					</div>		<!-- /.modal-dialog -->
				</div>		

	<script>
	
	var socket;
	var newURL = window.location.protocol + "//" + window.location.host;
	
	function refreshTabInvite()
	{
		$.get(newURL +"/users",callbackGet); <!-- post json -->
		function callbackGet(data, status) {				
		console.log(status);
		if(status == "success")
		{
			var tabUserId = [];
			console.log(data.users[0]);
			console.log(data.dateConnexion[0]);
				
			for(var i = 0; i< data.users.length;i++)
			{
				tabUserId.push((parseInt(data.users[i].split("User")[1])));	// recup id user dans la chaine user23
			}
			   var newRows = "";
			   for (var i = 0; i < data.users.length; i++) {
			   newRows += "<tr id=\"ligne" + (tabUserId[i])  + "\"" +  "><td>" + data.users[i] + " : " + 
						  data.dateConnexion[i] + " <button type=\"button\" class=\"decoButton\" id=\"" + tabUserId[i] + "\">Déconnecter</button></td></tr>";
			}
			$("#myTable").append(newRows);
							
			$('.decoButton').click(function() {
				$("#ligne" + this.id).remove();
				$.post(newURL +"/decoUser", {id:this.id} ,callbackPost); <!-- post json -->
							
				function callbackPost(data, status){
					console.log(status);
					console.log(data.success);
									
					if(status == "success")
					{
						//data.success;
						if(data.success)
						{
							console.log("success decoButton");
						}
						else
						{
							console.log("fail decoButton");
						}
					}
				}
			});
		}
		}
	}
	
	refreshTabInvite();
	
	socket = io.connect(newURL, { query: "admin=except" });

	socket.on('newInvite', function(message) {	

		$("#modalAccept").modal('show');
			
		$('#acceptButton').on('click', function()			
		{	
			socket.emit('inviteOk', {data:"invite"});
			$("#modalAccept").modal('hide');
				
			refreshTabInvite();
			
			window.location.reload();
		});
			
		$('#declineButton').on('click', function()			<!-- decline : invite = on suppr le last invite -->
		{	
			$.post(newURL +"/deleteLastUser", {user:"last"} ,callbackPost); <!-- post json -->
							
				function callbackPost(data, status){
					console.log(status);
					console.log(data.success);
									
					if(status == "success")
					{
						//data.success;
						if(data.success)
						{
							console.log("success declineButton");
						}
						else
						{
							console.log("fail declineButton");
						}
					}
				}

			refreshTabInvite();
			
			window.location.reload();		// refresh page
		});
			
			
	});
	
	</script>
  </body>
</html>